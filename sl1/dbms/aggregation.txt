Sample Data 
use HospitalDB 
db.Patients.insertMany([ 
{ _id: 1, name: "Amit Sharma", age: 30, disease: "Diabetes", city: "Pune", bill: 1500, hospital: 
"CityCare" }, 
{ _id: 2, name: "Priya Verma", age: 25, disease: "Fever", city: "Mumbai", bill: 800, hospital: 
"MediLife" }, 
{ _id: 3, name: "Rohit Mehra", age: 40, disease: "Asthma", city: "Delhi", bill: 2000, hospital: 
"HealthPlus" }, 
{ _id: 4, name: "Neha Patil", age: 35, disease: "Fever", city: "Pune", bill: 1200, hospital: 
"CityCare" }, 
{ _id: 5, name: "Karan Singh", age: 50, disease: "Diabetes", city: "Mumbai", bill: 2500, 
hospital: "MediLife" } 
]) 

Aggregation Operations 
a) Count patients per disease 
● db.Patients.aggregate([ 
{ $group: { _id: "$disease", totalPatients: { $sum: 1 } } } 
]) 
Groups records by disease and counts total patients per disease. 
b) Average bill amount per hospital 
● db.Patients.aggregate([ 
{ $group: { _id: "$hospital", avgBill: { $avg: "$bill" } } } 
]) 
Groups records by hospital and computes the average bill amount. 
c) Filter using $match and then group 
● db.Patients.aggregate([ 
{ $match: { city: "Pune" } }, 
{ $group: { _id: "$disease", totalBill: { $sum: "$bill" } } } 
]) 
Filters records for Pune city and sums their total bill per disease. 
d) Sort the aggregation result 
● db.Patients.aggregate([ 
{ $group: { _id: "$disease", totalPatients: { $sum: 1 } } }, 
{ $sort: { totalPatients: -1 } } 
]) 
Sorts diseases in descending order of patient count. 
e) Use $project for formatted output 
● db.Patients.aggregate([ 
{ $project: { name: 1, city: 1, disease: 1, bill_in_rupees: "$bill", bill_in_dollars: { $divide: 
["$bill", 80] } } } 
]) 
Displays bills in both rupees and equivalent USD using $project. 
Indexing 
a) Create a single field index 
● db.Patients.createIndex({ city: 1 }) 
Creates an ascending index on the city field to optimize search queries by city. 
b) Create a compound index 
● db.Patients.createIndex({ city: 1, disease: 1 }) 
Creates an index on both city and disease for faster queries filtering on these fields together. 
c) View all indexes 
● db.Patients.getIndexes() 
d) Drop an index 
● db.Patients.dropIndex({ city: 1 }) 
e) Example of Query Optimization 
● Before indexing: 
db.Patients.find({ city: "Pune", disease: "Fever" }).explain("executionStats") 
After indexing: 
db.Patients.createIndex({ city: 1, disease: 1 }) 
db.Patients.find({ city: "Pune", disease: "Fever" }).explain("executionStats") 
After creating the index, MongoDB performs fewer document scans and the query runs 
faster. 
Output 
1. Aggregation: Count patients per disease 
{ "_id": "Fever", "totalPatients": 2 } 
{ "_id": "Diabetes", "totalPatients": 2 } 
{ "_id": "Asthma", "totalPatients": 1 } 
2. Aggregation: Average bill per hospital 
{ "_id": "MediLife", "avgBill": 1650 } 
{ "_id": "CityCare", "avgBill": 1350 } 
{ "_id": "HealthPlus", "avgBill": 2000 } 
3. Indexing: List of created indexes 
[ 
{ "v": 2, "key": { "_id": 1 }, "name": "_id_" }, 
{ "v": 2, "key": { "city": 1 }, "name": "city_1" }, 
{ "v": 2, "key": { "city": 1, "disease": 1 }, "name": "city_1_disease_1" } 
]